<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cave Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #fff;
            overflow: hidden;
        }

        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #gameArea {
            width: 100%;
            height: 70vh;
            background: #2d2d2d;
            position: relative;
            overflow: hidden;
        }

        #player {
            width: 30px;
            height: 30px;
            background: #4CAF50;
            border-radius: 50%;
            position: absolute;
            transition: all 0.2s;
            z-index: 10;
        }

        .room {
            width: 100%;
            height: 100%;
            position: absolute;
            background: #2d2d2d;
        }

        .wall {
            background: #666;
            position: absolute;
        }

        .item {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            position: absolute;
            cursor: pointer;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .rope { background: #8B4513; }
        .anchor { background: #C0C0C0; }
        .key { background: #FFD700; }
        .torch { background: #FF4500; }

        .door {
            width: 40px;
            height: 60px;
            background: #8B4513;
            position: absolute;
            border: 2px solid #654321;
        }

        .locked {
            background: #654321 !important;
        }

        .pit {
            width: 80px;
            height: 20px;
            background: #000;
            position: absolute;
            border-radius: 10px;
        }

        .climbable {
            background: #228B22 !important;
        }

        #ui {
            height: 30vh;
            background: #333;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        #inventory {
            flex: 1;
            border: 2px solid #555;
            padding: 10px;
            margin-bottom: 10px;
        }

        #inventoryItems {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .inventoryItem {
            padding: 5px 10px;
            background: #555;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .selected {
            background: #4CAF50 !important;
        }

        #controls {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 5px;
            height: 120px;
        }

        .control-btn {
            background: #555;
            border: none;
            color: white;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .control-btn:active {
            background: #777;
        }

        #upBtn { grid-column: 2; grid-row: 1; }
        #leftBtn { grid-column: 1; grid-row: 2; }
        #rightBtn { grid-column: 3; grid-row: 2; }
        #downBtn { grid-column: 2; grid-row: 3; }
        #useBtn { grid-column: 2; grid-row: 2; background: #4CAF50; }

        #message {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameArea">
            <div id="player"></div>
            <div id="currentRoom" class="room"></div>
        </div>

        <div id="ui">
            <div id="inventory">
                <div>Ekwipunek:</div>
                <div id="inventoryItems"></div>
            </div>

            <div id="controls">
                <button id="upBtn" class="control-btn">↑</button>
                <button id="leftBtn" class="control-btn">←</button>
                <button id="useBtn" class="control-btn">USE</button>
                <button id="rightBtn" class="control-btn">→</button>
                <button id="downBtn" class="control-btn">↓</button>
            </div>
        </div>

        <div id="message"></div>
    </div>

    <script type="text/javascript">
        class CaveExplorer {
            constructor() {
                this.player = { x: 50, y: 50, room: 0 };
                this.inventory = [];
                this.selectedItem = null;
                this.currentRoom = 0;

                this.rooms = [
                    // Room 0 - Start
                    {
                        items: [
                            { type: 'rope', x: 200, y: 100 },
                            { type: 'torch', x: 300, y: 150 }
                        ],
                        walls: [
                            { x: 0, y: 0, width: 20, height: 400 },
                            { x: 0, y: 0, width: 400, height: 20 },
                            { x: 380, y: 0, width: 20, height: 400 },
                            { x: 0, y: 380, width: 400, height: 20 }
                        ],
                        doors: [
                            { x: 360, y: 180, width: 20, height: 40, toRoom: 1, locked: false }
                        ],
                        obstacles: []
                    },
                    // Room 1 - Pit room
                    {
                        items: [
                            { type: 'key', x: 300, y: 50 }
                        ],
                        walls: [
                            { x: 0, y: 0, width: 20, height: 400 },
                            { x: 0, y: 0, width: 400, height: 20 },
                            { x: 380, y: 0, width: 20, height: 400 },
                            { x: 0, y: 380, width: 400, height: 20 }
                        ],
                        doors: [
                            { x: 0, y: 180, width: 20, height: 40, toRoom: 0, locked: false },
                            { x: 360, y: 180, width: 20, height: 40, toRoom: 2, locked: true }
                        ],
                        obstacles: [
                            { type: 'pit', x: 150, y: 200, width: 80, height: 20, climbable: false }
                        ]
                    },
                    // Room 2 - Anchor room
                    {
                        items: [
                            { type: 'anchor', x: 100, y: 100 }
                        ],
                        walls: [
                            { x: 0, y: 0, width: 20, height: 400 },
                            { x: 0, y: 0, width: 400, height: 20 },
                            { x: 380, y: 0, width: 20, height: 400 },
                            { x: 0, y: 380, width: 400, height: 20 }
                        ],
                        doors: [
                            { x: 0, y: 180, width: 20, height: 40, toRoom: 1, locked: false }
                        ],
                        obstacles: []
                    }
                ];

                this.init();
            }

            init() {
                this.updateDisplay();
                this.setupControls();
                this.showMessage("Witaj w jaskini! Eksploruj i zbieraj przedmioty.");
            }

            setupControls() {
                document.getElementById('upBtn').addEventListener('touchstart', () => this.movePlayer(0, -30));
                document.getElementById('downBtn').addEventListener('touchstart', () => this.movePlayer(0, 30));
                document.getElementById('leftBtn').addEventListener('touchstart', () => this.movePlayer(-30, 0));
                document.getElementById('rightBtn').addEventListener('touchstart', () => this.movePlayer(30, 0));
                document.getElementById('useBtn').addEventListener('touchstart', () => this.useItem());

                // Keyboard support
                document.addEventListener('keydown', (e) => {
                    switch(e.key) {
                        case 'ArrowUp': this.movePlayer(0, -30); break;
                        case 'ArrowDown': this.movePlayer(0, 30); break;
                        case 'ArrowLeft': this.movePlayer(-30, 0); break;
                        case 'ArrowRight': this.movePlayer(30, 0); break;
                        case ' ': this.useItem(); break;
                    }
                });
            }

            movePlayer(dx, dy) {
                const newX = this.player.x + dx;
                const newY = this.player.y + dy;

                if (this.canMoveTo(newX, newY)) {
                    this.player.x = newX;
                    this.player.y = newY;
                    this.checkCollisions();
                    this.updateDisplay();
                }
            }

            canMoveTo(x, y) {
                const room = this.rooms[this.currentRoom];

                // Check walls
                for (let wall of room.walls) {
                    if (x + 15 > wall.x && x - 15 < wall.x + wall.width &&
                        y + 15 > wall.y && y - 15 < wall.y + wall.height) {
                        return false;
                    }
                }

                // Check obstacles (except climbable pits)
                for (let obstacle of room.obstacles) {
                    if (!obstacle.climbable &&
                        x + 15 > obstacle.x && x - 15 < obstacle.x + obstacle.width &&
                        y + 15 > obstacle.y && y - 15 < obstacle.y + obstacle.height) {
                        return false;
                    }
                }

                return true;
            }

            checkCollisions() {
                const room = this.rooms[this.currentRoom];

                // Check items
                room.items = room.items.filter(item => {
                    if (Math.abs(this.player.x - item.x) < 25 && Math.abs(this.player.y - item.y) < 25) {
                        this.collectItem(item.type);
                        return false;
                    }
                    return true;
                });

                // Check doors
                for (let door of room.doors) {
                    if (this.player.x + 15 > door.x && this.player.x - 15 < door.x + door.width &&
                        this.player.y + 15 > door.y && this.player.y - 15 < door.y + door.height) {
                        if (!door.locked) {
                            this.currentRoom = door.toRoom;
                            this.player.x = door.toRoom > this.currentRoom ? 50 : 330;
                            this.showMessage("Przeszedłeś do nowego pomieszczenia!");
                            break;
                        } else {
                            this.showMessage("Drzwi są zamknięte!");
                        }
                    }
                }
            }

            collectItem(type) {
                this.inventory.push(type);
                this.showMessage(`Zebrałeś: ${this.getItemName(type)}`);
                this.updateInventory();
            }

            getItemName(type) {
                const names = {
                    'rope': 'Lina',
                    'anchor': 'Kotwa',
                    'key': 'Klucz',
                    'torch': 'Pochodnia'
                };
                return names[type] || type;
            }

            useItem() {
                if (!this.selectedItem) {
                    this.showMessage("Najpierw wybierz przedmiot z ekwipunku!");
                    return;
                }

                const room = this.rooms[this.currentRoom];

                // Use key on locked door
                if (this.selectedItem === 'key') {
                    for (let door of room.doors) {
                        if (door.locked &&
                            Math.abs(this.player.x - (door.x + door.width/2)) < 40 &&
                            Math.abs(this.player.y - (door.y + door.height/2)) < 40) {
                            door.locked = false;
                            this.inventory.splice(this.inventory.indexOf('key'), 1);
                            this.selectedItem = null;
                            this.showMessage("Otworzyłeś drzwi!");
                            this.updateInventory();
                            this.updateDisplay();
                            return;
                        }
                    }
                }

                // Use rope + anchor on pit
                if (this.selectedItem === 'rope' && this.inventory.includes('anchor')) {
                    for (let obstacle of room.obstacles) {
                        if (obstacle.type === 'pit' && !obstacle.climbable &&
                            Math.abs(this.player.x - (obstacle.x + obstacle.width/2)) < 60 &&
                            Math.abs(this.player.y - (obstacle.y + obstacle.height/2)) < 60) {
                            obstacle.climbable = true;
                            this.inventory.splice(this.inventory.indexOf('rope'), 1);
                            this.inventory.splice(this.inventory.indexOf('anchor'), 1);
                            this.selectedItem = null;
                            this.showMessage("Użyłeś liny z kotwą! Możesz przejść przez dziurę.");
                            this.updateInventory();
                            this.updateDisplay();
                            return;
                        }
                    }
                }

                this.showMessage("Nie możesz tutaj użyć tego przedmiotu.");
            }

            updateDisplay() {
                const player = document.getElementById('player');
                player.style.left = this.player.x + 'px';
                player.style.top = this.player.y + 'px';

                const roomDiv = document.getElementById('currentRoom');
                roomDiv.innerHTML = '';

                const room = this.rooms[this.currentRoom];

                // Add walls
                room.walls.forEach(wall => {
                    const wallDiv = document.createElement('div');
                    wallDiv.className = 'wall';
                    wallDiv.style.left = wall.x + 'px';
                    wallDiv.style.top = wall.y + 'px';
                    wallDiv.style.width = wall.width + 'px';
                    wallDiv.style.height = wall.height + 'px';
                    roomDiv.appendChild(wallDiv);
                });

                // Add items
                room.items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `item ${item.type}`;
                    itemDiv.style.left = item.x + 'px';
                    itemDiv.style.top = item.y + 'px';
                    roomDiv.appendChild(itemDiv);
                });

                // Add doors
                room.doors.forEach(door => {
                    const doorDiv = document.createElement('div');
                    doorDiv.className = `door ${door.locked ? 'locked' : ''}`;
                    doorDiv.style.left = door.x + 'px';
                    doorDiv.style.top = door.y + 'px';
                    doorDiv.style.width = door.width + 'px';
                    doorDiv.style.height = door.height + 'px';
                    roomDiv.appendChild(doorDiv);
                });

                // Add obstacles
                room.obstacles.forEach(obstacle => {
                    const obstacleDiv = document.createElement('div');
                    obstacleDiv.className = `${obstacle.type} ${obstacle.climbable ? 'climbable' : ''}`;
                    obstacleDiv.style.left = obstacle.x + 'px';
                    obstacleDiv.style.top = obstacle.y + 'px';
                    obstacleDiv.style.width = obstacle.width + 'px';
                    obstacleDiv.style.height = obstacle.height + 'px';
                    roomDiv.appendChild(obstacleDiv);
                });
            }

            updateInventory() {
                const inventoryDiv = document.getElementById('inventoryItems');
                inventoryDiv.innerHTML = '';

                this.inventory.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `inventoryItem ${this.selectedItem === item ? 'selected' : ''}`;
                    itemDiv.textContent = this.getItemName(item);
                    itemDiv.addEventListener('click', () => {
                        this.selectedItem = this.selectedItem === item ? null : item;
                        this.updateInventory();
                    });
                    inventoryDiv.appendChild(itemDiv);
                });
            }

            showMessage(text) {
                const messageDiv = document.getElementById('message');
                messageDiv.textContent = text;
                messageDiv.style.display = 'block';
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 3000);
            }
        }

        // Start game when page loads
        window.addEventListener('load', () => {
            new CaveExplorer();
        });
    </script>
</body>
</html>